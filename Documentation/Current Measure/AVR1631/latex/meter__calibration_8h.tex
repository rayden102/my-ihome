\hypertarget{meter__calibration_8h}{\section{meter\-\_\-calibration.\-h File Reference}
\label{meter__calibration_8h}\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}}
}


Meter Calibration routine.  


\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\hypertarget{meter__calibration_8h_ac851cdac87c607e7a5284828d5862c72}{\#define \hyperlink{meter__calibration_8h_ac851cdac87c607e7a5284828d5862c72}{U\-S\-A\-R\-T}~U\-S\-A\-R\-T\-C1}\label{meter__calibration_8h_ac851cdac87c607e7a5284828d5862c72}

\begin{DoxyCompactList}\small\item\em Select the U\-S\-A\-R\-T to be used. \end{DoxyCompactList}\item 
\hypertarget{meter__calibration_8h_ab87f100a40226d40c46e1981b1af10aa}{\#define \hyperlink{meter__calibration_8h_ab87f100a40226d40c46e1981b1af10aa}{U\-S\-A\-R\-T\-\_\-\-P\-O\-R\-T}~P\-O\-R\-T\-C}\label{meter__calibration_8h_ab87f100a40226d40c46e1981b1af10aa}

\begin{DoxyCompactList}\small\item\em Select which Port is used as U\-S\-A\-R\-T. \end{DoxyCompactList}\item 
\hypertarget{meter__calibration_8h_ae27d9eb0a90319697067e832896c11b8}{\#define \hyperlink{meter__calibration_8h_ae27d9eb0a90319697067e832896c11b8}{U\-A\-R\-T\-\_\-\-B\-S\-C\-A\-L\-E\-\_\-\-V\-A\-L\-U\-E}~0}\label{meter__calibration_8h_ae27d9eb0a90319697067e832896c11b8}

\begin{DoxyCompactList}\small\item\em Configure U\-S\-A\-R\-T Scale factor. Here,Selected as Zero. \end{DoxyCompactList}\item 
\hypertarget{meter__calibration_8h_a9485ea71f9f4618b192de0821d38de1c}{\#define \hyperlink{meter__calibration_8h_a9485ea71f9f4618b192de0821d38de1c}{U\-A\-R\-T\-\_\-\-B\-S\-E\-L\-\_\-\-V\-A\-L\-U\-E}~51}\label{meter__calibration_8h_a9485ea71f9f4618b192de0821d38de1c}

\begin{DoxyCompactList}\small\item\em Configure for Baud Rate Value E.\-g.\-:Target\-: Internal R\-C 32\-M\-Hz (default) For 38400bps, U\-B\-R\-R = 32\-M\-Hz/(16$\ast$38400)-\/1 = 51.\-08. \end{DoxyCompactList}\item 
\hypertarget{meter__calibration_8h_ab5c5e4bd6ab421ea81cf2f9b5a6e86b4}{\#define \hyperlink{meter__calibration_8h_ab5c5e4bd6ab421ea81cf2f9b5a6e86b4}{U\-A\-R\-T\-\_\-\-C\-H\-A\-R\-A\-C\-T\-E\-R\-\_\-\-S\-I\-Z\-E}~U\-S\-A\-R\-T\-\_\-\-C\-H\-S\-I\-Z\-E\-\_\-8\-B\-I\-T\-\_\-gc}\label{meter__calibration_8h_ab5c5e4bd6ab421ea81cf2f9b5a6e86b4}

\begin{DoxyCompactList}\small\item\em Define U\-A\-R\-T Character Size. \end{DoxyCompactList}\item 
\hypertarget{meter__calibration_8h_a5330a1383da39a9c7a0255bd423b6ef4}{\#define \hyperlink{meter__calibration_8h_a5330a1383da39a9c7a0255bd423b6ef4}{U\-A\-R\-T\-\_\-\-P\-A\-R\-I\-T\-Y\-\_\-\-M\-O\-D\-E\-\_\-\-S\-I\-Z\-E}~U\-S\-A\-R\-T\-\_\-\-P\-M\-O\-D\-E\-\_\-\-D\-I\-S\-A\-B\-L\-E\-D\-\_\-gc}\label{meter__calibration_8h_a5330a1383da39a9c7a0255bd423b6ef4}

\begin{DoxyCompactList}\small\item\em Define U\-A\-R\-T Parity Mode. \end{DoxyCompactList}\item 
\hypertarget{meter__calibration_8h_a8913b4bfc15703ad42ca91552a8d5796}{\#define \hyperlink{meter__calibration_8h_a8913b4bfc15703ad42ca91552a8d5796}{O\-M\-E\-G\-A}~(float)0.\-07853982}\label{meter__calibration_8h_a8913b4bfc15703ad42ca91552a8d5796}

\begin{DoxyCompactList}\small\item\em Define O\-M\-E\-G\-A = (2 $\ast$ pi $\ast$ (Freq / Fsampling) ) \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{meter__calibration_8h_aea1bc020efc7a4ae50ea6a84a6c9a252}{calibrate\-\_\-current} (void)
\item 
void \hyperlink{meter__calibration_8h_aaefadfa72bfbcb5699934208b9170c01}{calibrate\-\_\-no\-\_\-load} (void)
\item 
void \hyperlink{meter__calibration_8h_a2ffa4a126bc2cac3db780da2bb77852c}{calibrate\-\_\-phase} (void)
\item 
void \hyperlink{meter__calibration_8h_aed64b378f05481243a22ac5cb98d633b}{calibrate\-\_\-time} (void)
\item 
void \hyperlink{meter__calibration_8h_acc7746fc48df33568766f5e0fa0dcc35}{calibrate\-\_\-time\-\_\-date} (void)
\item 
void \hyperlink{meter__calibration_8h_a29112cf81dd3b55daa8b06de6a6f42a2}{calibrate\-\_\-date} (void)
\item 
void \hyperlink{meter__calibration_8h_a8d389745040df26e173cfa3b1b26a8dd}{calibrate\-\_\-voltage} (void)
\item 
void \hyperlink{meter__calibration_8h_a3d3da3079a4428cb7fbf8a9e71ce310e}{calibrate\-\_\-watt} (void)
\item 
void \hyperlink{meter__calibration_8h_aeff8a6a9ffc356ae6c2bb5727fc6c500}{phase\-\_\-calc} (float, uint8\-\_\-t)
\item 
void \hyperlink{meter__calibration_8h_ae50cf519b28aaa3a867ea4531ddfa68e}{read\-\_\-tx\-\_\-array} (uint8\-\_\-t cnt)
\item 
void \hyperlink{meter__calibration_8h_a22fd71c52ac49190369db570ee5f69e0}{uart\-\_\-getdata} (uint8\-\_\-t)
\item 
void \hyperlink{meter__calibration_8h_a65d12b2681a986ff097e6428136f6aa0}{uart\-\_\-print} (void)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hypertarget{meter__calibration_8h_aa608ec48a4376689d32dffc57c3958a3}{uint8\-\_\-t {\bfseries rx\-\_\-buffer} \mbox{[}10\mbox{]}}\label{meter__calibration_8h_aa608ec48a4376689d32dffc57c3958a3}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
Meter Calibration routine. \begin{DoxyParagraph}{Application note\-:}
A\-V\-R1631\-: Energy Meter Reference Design with A\-Txmega32\-A4
\end{DoxyParagraph}
\begin{DoxyParagraph}{Documentation}
For comprehensive code documentation, supported compilers, compiler settings and supported devices see readme.\-html
\end{DoxyParagraph}
\begin{DoxyAuthor}{Author}
Atmel Corporation\-: \href{http://www.atmel.com}{\tt http\-://www.\-atmel.\-com} \par
 Support email\-: \href{mailto:avr@atmel.com}{\tt avr@atmel.\-com}
\end{DoxyAuthor}
\$\-Revision\-: 1.\-0 \par
 \$\-Date\-: 2012-\/07-\/01 10\-:10\-:10 +0530 \par


Copyright (c) 2008, Atmel Corporation All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met\-:


\begin{DoxyEnumerate}
\item Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
\end{DoxyEnumerate}


\begin{DoxyEnumerate}
\item Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
\end{DoxyEnumerate}


\begin{DoxyEnumerate}
\item The name of A\-T\-M\-E\-L may not be used to endorse or promote products derived from this software without specific prior written permission.
\end{DoxyEnumerate}

T\-H\-I\-S S\-O\-F\-T\-W\-A\-R\-E I\-S P\-R\-O\-V\-I\-D\-E\-D B\-Y A\-T\-M\-E\-L \char`\"{}\-A\-S I\-S\char`\"{} A\-N\-D A\-N\-Y E\-X\-P\-R\-E\-S\-S O\-R I\-M\-P\-L\-I\-E\-D W\-A\-R\-R\-A\-N\-T\-I\-E\-S, I\-N\-C\-L\-U\-D\-I\-N\-G, B\-U\-T N\-O\-T L\-I\-M\-I\-T\-E\-D T\-O, T\-H\-E I\-M\-P\-L\-I\-E\-D W\-A\-R\-R\-A\-N\-T\-I\-E\-S O\-F M\-E\-R\-C\-H\-A\-N\-T\-A\-B\-I\-L\-I\-T\-Y A\-N\-D F\-I\-T\-N\-E\-S\-S F\-O\-R A P\-A\-R\-T\-I\-C\-U\-L\-A\-R P\-U\-R\-P\-O\-S\-E A\-R\-E E\-X\-P\-R\-E\-S\-S\-L\-Y A\-N\-D S\-P\-E\-C\-I\-F\-I\-C\-A\-L\-L\-Y D\-I\-S\-C\-L\-A\-I\-M\-E\-D. I\-N N\-O E\-V\-E\-N\-T S\-H\-A\-L\-L A\-T\-M\-E\-L B\-E L\-I\-A\-B\-L\-E F\-O\-R A\-N\-Y D\-I\-R\-E\-C\-T, I\-N\-D\-I\-R\-E\-C\-T, I\-N\-C\-I\-D\-E\-N\-T\-A\-L, S\-P\-E\-C\-I\-A\-L, E\-X\-E\-M\-P\-L\-A\-R\-Y, O\-R C\-O\-N\-S\-E\-Q\-U\-E\-N\-T\-I\-A\-L D\-A\-M\-A\-G\-E\-S (I\-N\-C\-L\-U\-D\-I\-N\-G, B\-U\-T N\-O\-T L\-I\-M\-I\-T\-E\-D T\-O, P\-R\-O\-C\-U\-R\-E\-M\-E\-N\-T O\-F S\-U\-B\-S\-T\-I\-T\-U\-T\-E G\-O\-O\-D\-S O\-R S\-E\-R\-V\-I\-C\-E\-S; L\-O\-S\-S O\-F U\-S\-E, D\-A\-T\-A, O\-R P\-R\-O\-F\-I\-T\-S; O\-R B\-U\-S\-I\-N\-E\-S\-S I\-N\-T\-E\-R\-R\-U\-P\-T\-I\-O\-N) H\-O\-W\-E\-V\-E\-R C\-A\-U\-S\-E\-D A\-N\-D O\-N A\-N\-Y T\-H\-E\-O\-R\-Y O\-F L\-I\-A\-B\-I\-L\-I\-T\-Y, W\-H\-E\-T\-H\-E\-R I\-N C\-O\-N\-T\-R\-A\-C\-T, S\-T\-R\-I\-C\-T L\-I\-A\-B\-I\-L\-I\-T\-Y, O\-R T\-O\-R\-T (I\-N\-C\-L\-U\-D\-I\-N\-G N\-E\-G\-L\-I\-G\-E\-N\-C\-E O\-R O\-T\-H\-E\-R\-W\-I\-S\-E) A\-R\-I\-S\-I\-N\-G I\-N A\-N\-Y W\-A\-Y O\-U\-T O\-F T\-H\-E U\-S\-E O\-F T\-H\-I\-S S\-O\-F\-T\-W\-A\-R\-E, E\-V\-E\-N I\-F A\-D\-V\-I\-S\-E\-D O\-F T\-H\-E P\-O\-S\-S\-I\-B\-I\-L\-I\-T\-Y O\-F S\-U\-C\-H D\-A\-M\-A\-G\-E. 

Definition in file \hyperlink{meter__calibration_8h_source}{meter\-\_\-calibration.\-h}.



\subsection{Function Documentation}
\hypertarget{meter__calibration_8h_aea1bc020efc7a4ae50ea6a84a6c9a252}{\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}!calibrate\-\_\-current@{calibrate\-\_\-current}}
\index{calibrate\-\_\-current@{calibrate\-\_\-current}!meter_calibration.h@{meter\-\_\-calibration.\-h}}
\subsubsection[{calibrate\-\_\-current}]{\setlength{\rightskip}{0pt plus 5cm}void calibrate\-\_\-current (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calibration_8h_aea1bc020efc7a4ae50ea6a84a6c9a252}
brief This function take the average of current for 30sec, caluculate the shunt constant and stores the calibration value into eeprom

/param volt\-\_\-input holds the input data from the user /param calibration\-\_\-temp accumulates the raw voltage value for calibration 

Definition at line 309 of file meter\-\_\-calibration.\-c.

\hypertarget{meter__calibration_8h_a29112cf81dd3b55daa8b06de6a6f42a2}{\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}!calibrate\-\_\-date@{calibrate\-\_\-date}}
\index{calibrate\-\_\-date@{calibrate\-\_\-date}!meter_calibration.h@{meter\-\_\-calibration.\-h}}
\subsubsection[{calibrate\-\_\-date}]{\setlength{\rightskip}{0pt plus 5cm}void calibrate\-\_\-date (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calibration_8h_a29112cf81dd3b55daa8b06de6a6f42a2}
brief This function updates the structure 'rtc\-Time' with the new date received through U\-A\-R\-T, 

Definition at line 206 of file meter\-\_\-calibration.\-c.

\hypertarget{meter__calibration_8h_aaefadfa72bfbcb5699934208b9170c01}{\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}!calibrate\-\_\-no\-\_\-load@{calibrate\-\_\-no\-\_\-load}}
\index{calibrate\-\_\-no\-\_\-load@{calibrate\-\_\-no\-\_\-load}!meter_calibration.h@{meter\-\_\-calibration.\-h}}
\subsubsection[{calibrate\-\_\-no\-\_\-load}]{\setlength{\rightskip}{0pt plus 5cm}void calibrate\-\_\-no\-\_\-load (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calibration_8h_aaefadfa72bfbcb5699934208b9170c01}
brief This function take the average of current at noload for 30sec, caluculate the offset current value and stores the calibration value into eeprom

/param calibration\-\_\-temp accumulates the raw current value for calibration /param calibration\-\_\-watt accumulates the raw active power value for calibration 

Definition at line 220 of file meter\-\_\-calibration.\-c.

\hypertarget{meter__calibration_8h_a2ffa4a126bc2cac3db780da2bb77852c}{\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}!calibrate\-\_\-phase@{calibrate\-\_\-phase}}
\index{calibrate\-\_\-phase@{calibrate\-\_\-phase}!meter_calibration.h@{meter\-\_\-calibration.\-h}}
\subsubsection[{calibrate\-\_\-phase}]{\setlength{\rightskip}{0pt plus 5cm}void calibrate\-\_\-phase (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calibration_8h_a2ffa4a126bc2cac3db780da2bb77852c}
brief This function take the average of power factor for 30sec, caluculate the phase constants and stores the calibration value into eeprom

/param current\-\_\-input holds the input data from the user /param calibration\-\_\-temp accumulates the raw voltage value for calibration /param pf\-\_\-temp calculates the actual power factor for phase calibration 

Definition at line 505 of file meter\-\_\-calibration.\-c.

\hypertarget{meter__calibration_8h_aed64b378f05481243a22ac5cb98d633b}{\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}!calibrate\-\_\-time@{calibrate\-\_\-time}}
\index{calibrate\-\_\-time@{calibrate\-\_\-time}!meter_calibration.h@{meter\-\_\-calibration.\-h}}
\subsubsection[{calibrate\-\_\-time}]{\setlength{\rightskip}{0pt plus 5cm}void calibrate\-\_\-time (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calibration_8h_aed64b378f05481243a22ac5cb98d633b}
brief This function updates the structure 'rtc\-Time' with the new time received through U\-A\-R\-T, R\-T\-C starts running with this new time 

Definition at line 195 of file meter\-\_\-calibration.\-c.

\hypertarget{meter__calibration_8h_acc7746fc48df33568766f5e0fa0dcc35}{\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}!calibrate\-\_\-time\-\_\-date@{calibrate\-\_\-time\-\_\-date}}
\index{calibrate\-\_\-time\-\_\-date@{calibrate\-\_\-time\-\_\-date}!meter_calibration.h@{meter\-\_\-calibration.\-h}}
\subsubsection[{calibrate\-\_\-time\-\_\-date}]{\setlength{\rightskip}{0pt plus 5cm}void calibrate\-\_\-time\-\_\-date (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calibration_8h_acc7746fc48df33568766f5e0fa0dcc35}
brief This function updates the date and time received through U\-A\-R\-T, R\-T\-C starts running with this new time 

Definition at line 183 of file meter\-\_\-calibration.\-c.

\hypertarget{meter__calibration_8h_a8d389745040df26e173cfa3b1b26a8dd}{\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}!calibrate\-\_\-voltage@{calibrate\-\_\-voltage}}
\index{calibrate\-\_\-voltage@{calibrate\-\_\-voltage}!meter_calibration.h@{meter\-\_\-calibration.\-h}}
\subsubsection[{calibrate\-\_\-voltage}]{\setlength{\rightskip}{0pt plus 5cm}void calibrate\-\_\-voltage (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calibration_8h_a8d389745040df26e173cfa3b1b26a8dd}
brief This function take the average of voltage for 30sec, caluculate the volt constant and stores the calibration value into eeprom

/param volt\-\_\-input holds the input data from the user /param calibration\-\_\-temp accumulates the raw voltage value for calibration 

Definition at line 271 of file meter\-\_\-calibration.\-c.

\hypertarget{meter__calibration_8h_a3d3da3079a4428cb7fbf8a9e71ce310e}{\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}!calibrate\-\_\-watt@{calibrate\-\_\-watt}}
\index{calibrate\-\_\-watt@{calibrate\-\_\-watt}!meter_calibration.h@{meter\-\_\-calibration.\-h}}
\subsubsection[{calibrate\-\_\-watt}]{\setlength{\rightskip}{0pt plus 5cm}void calibrate\-\_\-watt (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calibration_8h_a3d3da3079a4428cb7fbf8a9e71ce310e}
brief This function take the average of active power for 30sec, caluculate the watt constant and stores the calibration value into eeprom

/param watt\-\_\-input holds the input data from the user /param calibration\-\_\-watt accumulates the raw active power for calibration 

Definition at line 405 of file meter\-\_\-calibration.\-c.

\hypertarget{meter__calibration_8h_aeff8a6a9ffc356ae6c2bb5727fc6c500}{\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}!phase\-\_\-calc@{phase\-\_\-calc}}
\index{phase\-\_\-calc@{phase\-\_\-calc}!meter_calibration.h@{meter\-\_\-calibration.\-h}}
\subsubsection[{phase\-\_\-calc}]{\setlength{\rightskip}{0pt plus 5cm}void phase\-\_\-calc (
\begin{DoxyParamCaption}
\item[{float}]{pf\-\_\-avg, }
\item[{uint8\-\_\-t}]{g\-\_\-stage}
\end{DoxyParamCaption}
)}}\label{meter__calibration_8h_aeff8a6a9ffc356ae6c2bb5727fc6c500}
brief This function calculate the beta(\-B1) and A1 values 

Definition at line 592 of file meter\-\_\-calibration.\-c.

\hypertarget{meter__calibration_8h_ae50cf519b28aaa3a867ea4531ddfa68e}{\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}!read\-\_\-tx\-\_\-array@{read\-\_\-tx\-\_\-array}}
\index{read\-\_\-tx\-\_\-array@{read\-\_\-tx\-\_\-array}!meter_calibration.h@{meter\-\_\-calibration.\-h}}
\subsubsection[{read\-\_\-tx\-\_\-array}]{\setlength{\rightskip}{0pt plus 5cm}void read\-\_\-tx\-\_\-array (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{cnt}
\end{DoxyParamCaption}
)}}\label{meter__calibration_8h_ae50cf519b28aaa3a867ea4531ddfa68e}
brief This function load the array from flash


\begin{DoxyParams}{Parameters}
{\em tx\-\_\-read\mbox{[}$\,$\mbox{]}} & holds the data to be transmitted through uart \\
\hline
\end{DoxyParams}


Definition at line 172 of file meter\-\_\-calibration.\-c.

\hypertarget{meter__calibration_8h_a22fd71c52ac49190369db570ee5f69e0}{\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}!uart\-\_\-getdata@{uart\-\_\-getdata}}
\index{uart\-\_\-getdata@{uart\-\_\-getdata}!meter_calibration.h@{meter\-\_\-calibration.\-h}}
\subsubsection[{uart\-\_\-getdata}]{\setlength{\rightskip}{0pt plus 5cm}void uart\-\_\-getdata (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{tx}
\end{DoxyParamCaption}
)}}\label{meter__calibration_8h_a22fd71c52ac49190369db570ee5f69e0}
brief This function collect the calibration data from the user through U\-A\-R\-T


\begin{DoxyParams}{Parameters}
{\em rx\-\_\-complete\-\_\-flag} & is set on receiving complete data from the user \\
\hline
\end{DoxyParams}


Definition at line 149 of file meter\-\_\-calibration.\-c.

\hypertarget{meter__calibration_8h_a65d12b2681a986ff097e6428136f6aa0}{\index{meter\-\_\-calibration.\-h@{meter\-\_\-calibration.\-h}!uart\-\_\-print@{uart\-\_\-print}}
\index{uart\-\_\-print@{uart\-\_\-print}!meter_calibration.h@{meter\-\_\-calibration.\-h}}
\subsubsection[{uart\-\_\-print}]{\setlength{\rightskip}{0pt plus 5cm}void uart\-\_\-print (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calibration_8h_a65d12b2681a986ff097e6428136f6aa0}
brief This function send the character in tx\-\_\-read array into uart buffer 

Definition at line 133 of file meter\-\_\-calibration.\-c.

