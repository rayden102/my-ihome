\hypertarget{meter__task_8c}{\section{meter\-\_\-task.\-c File Reference}
\label{meter__task_8c}\index{meter\-\_\-task.\-c@{meter\-\_\-task.\-c}}
}


Meter initialisation.  


{\ttfamily \#include \char`\"{}meter.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{meter__task_8c_a51f29d3417ada33c90f1ebaabad23d36}{tamper\-\_\-check} (void)
\item 
\hyperlink{meter__task_8c_abc6e1844313aab2be0f995648c11fd95}{I\-S\-R} (P\-O\-R\-T\-B\-\_\-\-I\-N\-T0\-\_\-vect)
\begin{DoxyCompactList}\small\item\em This function is executed whenever the L\-C\-D key is pressed. \end{DoxyCompactList}\item 
\hyperlink{meter__task_8c_a0734971b2c3847c6e527957b3c331ebb}{I\-S\-R} (P\-O\-R\-T\-C\-\_\-\-I\-N\-T0\-\_\-vect)
\begin{DoxyCompactList}\small\item\em This function is executed on key press. \end{DoxyCompactList}\item 
\hyperlink{meter__task_8c_a06e269e09511fe0354626506e43e8e05}{I\-S\-R} (P\-O\-R\-T\-D\-\_\-\-I\-N\-T0\-\_\-vect)
\begin{DoxyCompactList}\small\item\em This function is executed whenever the power off is detected It will switch on the battery and C\-P\-U goes to power save mode. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hypertarget{meter__task_8c_afd360fb9947d32b0ac9aebc77c04d355}{uint8\-\_\-t {\bfseries rtc\-\_\-flag} = 0}\label{meter__task_8c_afd360fb9947d32b0ac9aebc77c04d355}

\item 
\hypertarget{meter__task_8c_a10f21698207fa8653801b38244fd1e4d}{uint8\-\_\-t {\bfseries key\-\_\-flag} = 0}\label{meter__task_8c_a10f21698207fa8653801b38244fd1e4d}

\item 
\hypertarget{meter__task_8c_a8ca145f58c24840496cb0cfedc4de27a}{uint8\-\_\-t {\bfseries magnetic\-\_\-tamper\-\_\-flag} = 0}\label{meter__task_8c_a8ca145f58c24840496cb0cfedc4de27a}

\item 
\hypertarget{meter__task_8c_a06eafd0ca356b436dd14f8922d71d55b}{uint8\-\_\-t {\bfseries cover\-\_\-open\-\_\-flag} = 0}\label{meter__task_8c_a06eafd0ca356b436dd14f8922d71d55b}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
Meter initialisation. \begin{DoxyParagraph}{Application note\-:}
A\-V\-R1631\-: Energy Meter Reference Design with A\-Txmega32\-A4
\end{DoxyParagraph}
\begin{DoxyParagraph}{Documentation}
For comprehensive code documentation, supported compilers, compiler settings and supported devices see readme.\-html
\end{DoxyParagraph}
\begin{DoxyAuthor}{Author}
Atmel Corporation\-: \href{http://www.atmel.com}{\tt http\-://www.\-atmel.\-com} \par
 Support email\-: \href{mailto:avr@atmel.com}{\tt avr@atmel.\-com}
\end{DoxyAuthor}
\$\-Revision\-: 1.\-0 \par
 \$\-Date\-: 2012-\/07-\/01 10\-:10\-:10 +0530 \par


Copyright (c) 2008, Atmel Corporation All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met\-:


\begin{DoxyEnumerate}
\item Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
\end{DoxyEnumerate}


\begin{DoxyEnumerate}
\item Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
\end{DoxyEnumerate}


\begin{DoxyEnumerate}
\item The name of A\-T\-M\-E\-L may not be used to endorse or promote products derived from this software without specific prior written permission.
\end{DoxyEnumerate}

T\-H\-I\-S S\-O\-F\-T\-W\-A\-R\-E I\-S P\-R\-O\-V\-I\-D\-E\-D B\-Y A\-T\-M\-E\-L \char`\"{}\-A\-S I\-S\char`\"{} A\-N\-D A\-N\-Y E\-X\-P\-R\-E\-S\-S O\-R I\-M\-P\-L\-I\-E\-D W\-A\-R\-R\-A\-N\-T\-I\-E\-S, I\-N\-C\-L\-U\-D\-I\-N\-G, B\-U\-T N\-O\-T L\-I\-M\-I\-T\-E\-D T\-O, T\-H\-E I\-M\-P\-L\-I\-E\-D W\-A\-R\-R\-A\-N\-T\-I\-E\-S O\-F M\-E\-R\-C\-H\-A\-N\-T\-A\-B\-I\-L\-I\-T\-Y A\-N\-D F\-I\-T\-N\-E\-S\-S F\-O\-R A P\-A\-R\-T\-I\-C\-U\-L\-A\-R P\-U\-R\-P\-O\-S\-E A\-R\-E E\-X\-P\-R\-E\-S\-S\-L\-Y A\-N\-D S\-P\-E\-C\-I\-F\-I\-C\-A\-L\-L\-Y D\-I\-S\-C\-L\-A\-I\-M\-E\-D. I\-N N\-O E\-V\-E\-N\-T S\-H\-A\-L\-L A\-T\-M\-E\-L B\-E L\-I\-A\-B\-L\-E F\-O\-R A\-N\-Y D\-I\-R\-E\-C\-T, I\-N\-D\-I\-R\-E\-C\-T, I\-N\-C\-I\-D\-E\-N\-T\-A\-L, S\-P\-E\-C\-I\-A\-L, E\-X\-E\-M\-P\-L\-A\-R\-Y, O\-R C\-O\-N\-S\-E\-Q\-U\-E\-N\-T\-I\-A\-L D\-A\-M\-A\-G\-E\-S (I\-N\-C\-L\-U\-D\-I\-N\-G, B\-U\-T N\-O\-T L\-I\-M\-I\-T\-E\-D T\-O, P\-R\-O\-C\-U\-R\-E\-M\-E\-N\-T O\-F S\-U\-B\-S\-T\-I\-T\-U\-T\-E G\-O\-O\-D\-S O\-R S\-E\-R\-V\-I\-C\-E\-S; L\-O\-S\-S O\-F U\-S\-E, D\-A\-T\-A, O\-R P\-R\-O\-F\-I\-T\-S; O\-R B\-U\-S\-I\-N\-E\-S\-S I\-N\-T\-E\-R\-R\-U\-P\-T\-I\-O\-N) H\-O\-W\-E\-V\-E\-R C\-A\-U\-S\-E\-D A\-N\-D O\-N A\-N\-Y T\-H\-E\-O\-R\-Y O\-F L\-I\-A\-B\-I\-L\-I\-T\-Y, W\-H\-E\-T\-H\-E\-R I\-N C\-O\-N\-T\-R\-A\-C\-T, S\-T\-R\-I\-C\-T L\-I\-A\-B\-I\-L\-I\-T\-Y, O\-R T\-O\-R\-T (I\-N\-C\-L\-U\-D\-I\-N\-G N\-E\-G\-L\-I\-G\-E\-N\-C\-E O\-R O\-T\-H\-E\-R\-W\-I\-S\-E) A\-R\-I\-S\-I\-N\-G I\-N A\-N\-Y W\-A\-Y O\-U\-T O\-F T\-H\-E U\-S\-E O\-F T\-H\-I\-S S\-O\-F\-T\-W\-A\-R\-E, E\-V\-E\-N I\-F A\-D\-V\-I\-S\-E\-D O\-F T\-H\-E P\-O\-S\-S\-I\-B\-I\-L\-I\-T\-Y O\-F S\-U\-C\-H D\-A\-M\-A\-G\-E. 

Definition in file \hyperlink{meter__task_8c_source}{meter\-\_\-task.\-c}.



\subsection{Function Documentation}
\hypertarget{meter__task_8c_abc6e1844313aab2be0f995648c11fd95}{\index{meter\-\_\-task.\-c@{meter\-\_\-task.\-c}!I\-S\-R@{I\-S\-R}}
\index{I\-S\-R@{I\-S\-R}!meter_task.c@{meter\-\_\-task.\-c}}
\subsubsection[{I\-S\-R}]{\setlength{\rightskip}{0pt plus 5cm}I\-S\-R (
\begin{DoxyParamCaption}
\item[{P\-O\-R\-T\-B\-\_\-\-I\-N\-T0\-\_\-vect}]{}
\end{DoxyParamCaption}
)}}\label{meter__task_8c_abc6e1844313aab2be0f995648c11fd95}


This function is executed whenever the L\-C\-D key is pressed. 


\begin{DoxyParams}{Parameters}
{\em key\-\_\-flag} & is incremented on each press and is cleared on reaching the top value \\
\hline
\end{DoxyParams}


Definition at line 114 of file meter\-\_\-task.\-c.

\hypertarget{meter__task_8c_a0734971b2c3847c6e527957b3c331ebb}{\index{meter\-\_\-task.\-c@{meter\-\_\-task.\-c}!I\-S\-R@{I\-S\-R}}
\index{I\-S\-R@{I\-S\-R}!meter_task.c@{meter\-\_\-task.\-c}}
\subsubsection[{I\-S\-R}]{\setlength{\rightskip}{0pt plus 5cm}I\-S\-R (
\begin{DoxyParamCaption}
\item[{P\-O\-R\-T\-C\-\_\-\-I\-N\-T0\-\_\-vect}]{}
\end{DoxyParamCaption}
)}}\label{meter__task_8c_a0734971b2c3847c6e527957b3c331ebb}


This function is executed on key press. 


\begin{DoxyParams}{Parameters}
{\em key\-\_\-flag} & is incremented on each press and is cleared on reaching the top value \\
\hline
\end{DoxyParams}
check for cover open pin status

check for magnetic tampering

check if P\-I\-N5\-\_\-bm is pressed 

Definition at line 134 of file meter\-\_\-task.\-c.

\hypertarget{meter__task_8c_a06e269e09511fe0354626506e43e8e05}{\index{meter\-\_\-task.\-c@{meter\-\_\-task.\-c}!I\-S\-R@{I\-S\-R}}
\index{I\-S\-R@{I\-S\-R}!meter_task.c@{meter\-\_\-task.\-c}}
\subsubsection[{I\-S\-R}]{\setlength{\rightskip}{0pt plus 5cm}I\-S\-R (
\begin{DoxyParamCaption}
\item[{P\-O\-R\-T\-D\-\_\-\-I\-N\-T0\-\_\-vect}]{}
\end{DoxyParamCaption}
)}}\label{meter__task_8c_a06e269e09511fe0354626506e43e8e05}


This function is executed whenever the power off is detected It will switch on the battery and C\-P\-U goes to power save mode. 


\begin{DoxyParams}{Parameters}
{\em key\-\_\-flag} & is incremented on each press and is cleared on reaching the top value \\
\hline
\end{DoxyParams}


Definition at line 171 of file meter\-\_\-task.\-c.

\hypertarget{meter__task_8c_a51f29d3417ada33c90f1ebaabad23d36}{\index{meter\-\_\-task.\-c@{meter\-\_\-task.\-c}!tamper\-\_\-check@{tamper\-\_\-check}}
\index{tamper\-\_\-check@{tamper\-\_\-check}!meter_task.c@{meter\-\_\-task.\-c}}
\subsubsection[{tamper\-\_\-check}]{\setlength{\rightskip}{0pt plus 5cm}void tamper\-\_\-check (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__task_8c_a51f29d3417ada33c90f1ebaabad23d36}
This function checks for different types of tampering such as earth fault current reversal, neutral cut, magnetic tampering check for earth fault tamper (Load earthing) \par
 compare the phase current is within 12\% of the neutral current

if tampering persist for 15 secs update the led status

check the status for Current Reversal tampering

if tampering detected toggle the T\-A\-M\-P\-E\-R\-\_\-\-C\-U\-R\-R\-E\-N\-T\-\_\-\-R\-E\-V\-E\-R\-S\-A\-L L\-E\-D

check the status for Neutral C\-U\-T tampering and configure the status led

check the status of Magnetic tamper flag and update the L\-E\-D 

Definition at line 58 of file meter\-\_\-task.\-c.

