\hypertarget{meter__calculations_8h}{\section{meter\-\_\-calculations.\-h File Reference}
\label{meter__calculations_8h}\index{meter\-\_\-calculations.\-h@{meter\-\_\-calculations.\-h}}
}


Meter Calibration routine.  


{\ttfamily \#include $<$math.\-h$>$}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\hypertarget{meter__calculations_8h_abfb6e0ec2b8711ccad3af7435831444b}{\#define {\bfseries V\-O\-L\-T\-\_\-\-G\-A\-I\-N}~1}\label{meter__calculations_8h_abfb6e0ec2b8711ccad3af7435831444b}

\item 
\hypertarget{meter__calculations_8h_a723455414fa26047e35c5e96c09ccf0c}{\#define {\bfseries F\-R\-E\-Q\-U\-E\-N\-C\-Y\-\_\-\-M\-A\-X}~5000}\label{meter__calculations_8h_a723455414fa26047e35c5e96c09ccf0c}

\item 
\hypertarget{meter__calculations_8h_aab1126a23f72e0d2b7e271f19ee330ba}{\#define {\bfseries F\-R\-E\-Q\-U\-E\-N\-C\-Y\-\_\-\-M\-I\-N}~25000}\label{meter__calculations_8h_aab1126a23f72e0d2b7e271f19ee330ba}

\item 
\hypertarget{meter__calculations_8h_aa2e5985e700c929fad072b814be73762}{\#define {\bfseries L\-P\-\_\-\-O\-R\-D\-E\-R}~6}\label{meter__calculations_8h_aa2e5985e700c929fad072b814be73762}

\item 
\hypertarget{meter__calculations_8h_aacb5b3fd71ef4f9424a4cb26255de70a}{\#define {\bfseries O\-N\-E\-\_\-\-P\-U\-L\-S\-E\-\_\-\-E\-N\-E\-R\-G\-Y\-\_\-\-T\-H\-R\-E\-S\-H\-O\-L\-D}~(float)0.\-0003125}\label{meter__calculations_8h_aacb5b3fd71ef4f9424a4cb26255de70a}

\item 
\hypertarget{meter__calculations_8h_a98b8801f0abfe02de8fcc69bcb145086}{\#define {\bfseries P\-U\-L\-S\-E\-\_\-\-O\-N\-\_\-\-T\-I\-M\-E}~13}\label{meter__calculations_8h_a98b8801f0abfe02de8fcc69bcb145086}

\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{meter__calculations_8h_a15f4d5e2ad4c2019d97b46bf228d38da}{calculate} (void)
\item 
void \hyperlink{meter__calculations_8h_a652f05506a918e5c9136fc014e1d42b8}{calculate\-\_\-freq} (void)
\item 
void \hyperlink{meter__calculations_8h_a5b8277cdae31f3fc56ce77726f5511fb}{get\-\_\-frequency} (void)
\item 
int16\-\_\-t \hyperlink{meter__calculations_8h_ad1c8219d5d9efbbcec5fa5328070d57b}{lp\-\_\-filter} (int16\-\_\-t $\ast$)
\item 
void \hyperlink{meter__calculations_8h_afd1b8bf2460cd858ce956e8ac527be04}{meter\-\_\-flush} (void)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hypertarget{meter__calculations_8h_a882b3f2750e7f1ef5f9a67155e08c229}{uint16\-\_\-t {\bfseries Vrms} \mbox{[}5\mbox{]}}\label{meter__calculations_8h_a882b3f2750e7f1ef5f9a67155e08c229}

\item 
\hypertarget{meter__calculations_8h_a6747774a33aadf3c6c93c8afe3a99b27}{uint16\-\_\-t {\bfseries Irms} \mbox{[}5\mbox{]}}\label{meter__calculations_8h_a6747774a33aadf3c6c93c8afe3a99b27}

\item 
\hypertarget{meter__calculations_8h_a8126a7d1168a8c8dc515de68b4eaef5f}{uint16\-\_\-t {\bfseries Nrms}}\label{meter__calculations_8h_a8126a7d1168a8c8dc515de68b4eaef5f}

\item 
\hypertarget{meter__calculations_8h_aa3ad12f2e7b1f6fb314c9585791c081a}{int16\-\_\-t {\bfseries offset} \mbox{[}7\mbox{]}}\label{meter__calculations_8h_aa3ad12f2e7b1f6fb314c9585791c081a}

\item 
\hypertarget{meter__calculations_8h_affc99939ee8f323ea2810bfb0b8e931c}{uint16\-\_\-t {\bfseries adc\-\_\-samples}}\label{meter__calculations_8h_affc99939ee8f323ea2810bfb0b8e931c}

\item 
\hypertarget{meter__calculations_8h_a97196fc638e5301ed97b30c1ce1a16b0}{int32\-\_\-t {\bfseries active\-\_\-energy\-\_\-signed}}\label{meter__calculations_8h_a97196fc638e5301ed97b30c1ce1a16b0}

\item 
\hypertarget{meter__calculations_8h_a17303f2b6e2c08701f025019b3d125ac}{int32\-\_\-t {\bfseries neutral\-\_\-power}}\label{meter__calculations_8h_a17303f2b6e2c08701f025019b3d125ac}

\item 
\hypertarget{meter__calculations_8h_adb64a954e0f44bdffef270d4e191c68c}{uint16\-\_\-t {\bfseries active\-\_\-power} \mbox{[}5\mbox{]}}\label{meter__calculations_8h_adb64a954e0f44bdffef270d4e191c68c}

\item 
\hypertarget{meter__calculations_8h_ac8969cb517e56f9bd9f064a00fc2e8a6}{uint16\-\_\-t {\bfseries apparent\-\_\-power}}\label{meter__calculations_8h_ac8969cb517e56f9bd9f064a00fc2e8a6}

\item 
\hypertarget{meter__calculations_8h_aeb3c4f44608b461fdff65ad93439e8e6}{int16\-\_\-t {\bfseries power\-\_\-factor}}\label{meter__calculations_8h_aeb3c4f44608b461fdff65ad93439e8e6}

\item 
\hypertarget{meter__calculations_8h_ade34fa214cbf079b08a7bd39d4d61359}{int32\-\_\-t {\bfseries volt\-\_\-temp}}\label{meter__calculations_8h_ade34fa214cbf079b08a7bd39d4d61359}

\item 
\hypertarget{meter__calculations_8h_a92cd3148ebda6e3afe8f88907c35bf35}{int32\-\_\-t {\bfseries ct\-\_\-temp}}\label{meter__calculations_8h_a92cd3148ebda6e3afe8f88907c35bf35}

\item 
\hypertarget{meter__calculations_8h_a8fe74f8e82ab49c05b312bd123263744}{int32\-\_\-t {\bfseries shunt\-\_\-temp}}\label{meter__calculations_8h_a8fe74f8e82ab49c05b312bd123263744}

\item 
\hypertarget{meter__calculations_8h_a60f9795e1c3a93940068f710497bfbf0}{uint8\-\_\-t {\bfseries calibration\-\_\-flag}}\label{meter__calculations_8h_a60f9795e1c3a93940068f710497bfbf0}

\item 
\hypertarget{meter__calculations_8h_adb7cd6a70685edca152f3974d810695d}{uint8\-\_\-t {\bfseries calibration\-\_\-count}}\label{meter__calculations_8h_adb7cd6a70685edca152f3974d810695d}

\item 
\hypertarget{meter__calculations_8h_a849b90ef2cde8a80e100f24d6c9105da}{uint8\-\_\-t \hyperlink{meter__calculations_8h_a849b90ef2cde8a80e100f24d6c9105da}{gain\-\_\-stage}}\label{meter__calculations_8h_a849b90ef2cde8a80e100f24d6c9105da}

\begin{DoxyCompactList}\small\item\em variables used in metering calculations \end{DoxyCompactList}\item 
\hypertarget{meter__calculations_8h_aea762e0e67fcafaf5b3cd61201769926}{uint16\-\_\-t {\bfseries frequency}}\label{meter__calculations_8h_aea762e0e67fcafaf5b3cd61201769926}

\item 
\hypertarget{meter__calculations_8h_a6fb4bdd69521fa850b5a74c975686cec}{int64\-\_\-t {\bfseries watts\-\_\-sum}}\label{meter__calculations_8h_a6fb4bdd69521fa850b5a74c975686cec}

\item 
\hypertarget{meter__calculations_8h_ac242952f34a52cca8815e01751a2a9cc}{int64\-\_\-t {\bfseries watts\-\_\-sum\-\_\-calib}}\label{meter__calculations_8h_ac242952f34a52cca8815e01751a2a9cc}

\item 
\hypertarget{meter__calculations_8h_a15996be6abf4deec05adb39a80432120}{uint8\-\_\-t {\bfseries freq\-\_\-cnt}}\label{meter__calculations_8h_a15996be6abf4deec05adb39a80432120}

\item 
\hypertarget{meter__calculations_8h_a849a64e49bba950e59334741ed063dd9}{uint8\-\_\-t {\bfseries offset\-\_\-cnt}}\label{meter__calculations_8h_a849a64e49bba950e59334741ed063dd9}

\item 
\hypertarget{meter__calculations_8h_a8e547707560422632d4b105c32d141f9}{uint16\-\_\-t {\bfseries max\-\_\-demand}}\label{meter__calculations_8h_a8e547707560422632d4b105c32d141f9}

\item 
\hypertarget{meter__calculations_8h_a82dfbbef67f3f25bb814c00a05b1983b}{float {\bfseries pulse\-\_\-energy\-\_\-2\-\_\-5ms}}\label{meter__calculations_8h_a82dfbbef67f3f25bb814c00a05b1983b}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
Meter Calibration routine. \begin{DoxyParagraph}{Application note\-:}
A\-V\-R1631\-: Energy Meter Reference Design with A\-Txmega32\-A4
\end{DoxyParagraph}
\begin{DoxyParagraph}{Documentation}
For comprehensive code documentation, supported compilers, compiler settings and supported devices see readme.\-html
\end{DoxyParagraph}
\begin{DoxyAuthor}{Author}
Atmel Corporation\-: \href{http://www.atmel.com}{\tt http\-://www.\-atmel.\-com} \par
 Support email\-: \href{mailto:avr@atmel.com}{\tt avr@atmel.\-com}
\end{DoxyAuthor}
\$\-Revision\-: 1.\-0 \par
 \$\-Date\-: 2012-\/07-\/01 10\-:10\-:10 +0530 \par


Copyright (c) 2008, Atmel Corporation All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met\-:


\begin{DoxyEnumerate}
\item Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
\end{DoxyEnumerate}


\begin{DoxyEnumerate}
\item Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
\end{DoxyEnumerate}


\begin{DoxyEnumerate}
\item The name of A\-T\-M\-E\-L may not be used to endorse or promote products derived from this software without specific prior written permission.
\end{DoxyEnumerate}

T\-H\-I\-S S\-O\-F\-T\-W\-A\-R\-E I\-S P\-R\-O\-V\-I\-D\-E\-D B\-Y A\-T\-M\-E\-L \char`\"{}\-A\-S I\-S\char`\"{} A\-N\-D A\-N\-Y E\-X\-P\-R\-E\-S\-S O\-R I\-M\-P\-L\-I\-E\-D W\-A\-R\-R\-A\-N\-T\-I\-E\-S, I\-N\-C\-L\-U\-D\-I\-N\-G, B\-U\-T N\-O\-T L\-I\-M\-I\-T\-E\-D T\-O, T\-H\-E I\-M\-P\-L\-I\-E\-D W\-A\-R\-R\-A\-N\-T\-I\-E\-S O\-F M\-E\-R\-C\-H\-A\-N\-T\-A\-B\-I\-L\-I\-T\-Y A\-N\-D F\-I\-T\-N\-E\-S\-S F\-O\-R A P\-A\-R\-T\-I\-C\-U\-L\-A\-R P\-U\-R\-P\-O\-S\-E A\-R\-E E\-X\-P\-R\-E\-S\-S\-L\-Y A\-N\-D S\-P\-E\-C\-I\-F\-I\-C\-A\-L\-L\-Y D\-I\-S\-C\-L\-A\-I\-M\-E\-D. I\-N N\-O E\-V\-E\-N\-T S\-H\-A\-L\-L A\-T\-M\-E\-L B\-E L\-I\-A\-B\-L\-E F\-O\-R A\-N\-Y D\-I\-R\-E\-C\-T, I\-N\-D\-I\-R\-E\-C\-T, I\-N\-C\-I\-D\-E\-N\-T\-A\-L, S\-P\-E\-C\-I\-A\-L, E\-X\-E\-M\-P\-L\-A\-R\-Y, O\-R C\-O\-N\-S\-E\-Q\-U\-E\-N\-T\-I\-A\-L D\-A\-M\-A\-G\-E\-S (I\-N\-C\-L\-U\-D\-I\-N\-G, B\-U\-T N\-O\-T L\-I\-M\-I\-T\-E\-D T\-O, P\-R\-O\-C\-U\-R\-E\-M\-E\-N\-T O\-F S\-U\-B\-S\-T\-I\-T\-U\-T\-E G\-O\-O\-D\-S O\-R S\-E\-R\-V\-I\-C\-E\-S; L\-O\-S\-S O\-F U\-S\-E, D\-A\-T\-A, O\-R P\-R\-O\-F\-I\-T\-S; O\-R B\-U\-S\-I\-N\-E\-S\-S I\-N\-T\-E\-R\-R\-U\-P\-T\-I\-O\-N) H\-O\-W\-E\-V\-E\-R C\-A\-U\-S\-E\-D A\-N\-D O\-N A\-N\-Y T\-H\-E\-O\-R\-Y O\-F L\-I\-A\-B\-I\-L\-I\-T\-Y, W\-H\-E\-T\-H\-E\-R I\-N C\-O\-N\-T\-R\-A\-C\-T, S\-T\-R\-I\-C\-T L\-I\-A\-B\-I\-L\-I\-T\-Y, O\-R T\-O\-R\-T (I\-N\-C\-L\-U\-D\-I\-N\-G N\-E\-G\-L\-I\-G\-E\-N\-C\-E O\-R O\-T\-H\-E\-R\-W\-I\-S\-E) A\-R\-I\-S\-I\-N\-G I\-N A\-N\-Y W\-A\-Y O\-U\-T O\-F T\-H\-E U\-S\-E O\-F T\-H\-I\-S S\-O\-F\-T\-W\-A\-R\-E, E\-V\-E\-N I\-F A\-D\-V\-I\-S\-E\-D O\-F T\-H\-E P\-O\-S\-S\-I\-B\-I\-L\-I\-T\-Y O\-F S\-U\-C\-H D\-A\-M\-A\-G\-E. 

Definition in file \hyperlink{meter__calculations_8h_source}{meter\-\_\-calculations.\-h}.



\subsection{Function Documentation}
\hypertarget{meter__calculations_8h_a15f4d5e2ad4c2019d97b46bf228d38da}{\index{meter\-\_\-calculations.\-h@{meter\-\_\-calculations.\-h}!calculate@{calculate}}
\index{calculate@{calculate}!meter_calculations.h@{meter\-\_\-calculations.\-h}}
\subsubsection[{calculate}]{\setlength{\rightskip}{0pt plus 5cm}void calculate (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calculations_8h_a15f4d5e2ad4c2019d97b46bf228d38da}
brief This function is called on every 1sec and perform the calculation of metering paramters


\begin{DoxyParams}{Parameters}
{\em Irms} & contains the root mean square value of current on phase line \\
\hline
{\em Vrms} & contains the root mean square value of voltage \\
\hline
{\em Nrms} & contains the root mean square value of current on neutral line \\
\hline
{\em apparent\-\_\-power} & holds the apparent energy (V\-A) \\
\hline
{\em active\-\_\-power} & holds the active energy (Watts) \\
\hline
{\em power\-\_\-factor} & hols the power factor(\-P\-F) \\
\hline
\end{DoxyParams}


Definition at line 233 of file meter\-\_\-calculations.\-c.

\hypertarget{meter__calculations_8h_a652f05506a918e5c9136fc014e1d42b8}{\index{meter\-\_\-calculations.\-h@{meter\-\_\-calculations.\-h}!calculate\-\_\-freq@{calculate\-\_\-freq}}
\index{calculate\-\_\-freq@{calculate\-\_\-freq}!meter_calculations.h@{meter\-\_\-calculations.\-h}}
\subsubsection[{calculate\-\_\-freq}]{\setlength{\rightskip}{0pt plus 5cm}void calculate\-\_\-freq (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calculations_8h_a652f05506a918e5c9136fc014e1d42b8}
brief This function calculate line frequency from the value


\begin{DoxyParams}{Parameters}
{\em frequency} & hold the line frequency. \\
\hline
{\em freq\-\_\-avg} & hold the average timer value. \\
\hline
\end{DoxyParams}


Definition at line 396 of file meter\-\_\-calculations.\-c.

\hypertarget{meter__calculations_8h_a5b8277cdae31f3fc56ce77726f5511fb}{\index{meter\-\_\-calculations.\-h@{meter\-\_\-calculations.\-h}!get\-\_\-frequency@{get\-\_\-frequency}}
\index{get\-\_\-frequency@{get\-\_\-frequency}!meter_calculations.h@{meter\-\_\-calculations.\-h}}
\subsubsection[{get\-\_\-frequency}]{\setlength{\rightskip}{0pt plus 5cm}void get\-\_\-frequency (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calculations_8h_a5b8277cdae31f3fc56ce77726f5511fb}
function check for the sign change in voltage signal for frequency calucaulation.


\begin{DoxyParams}{Parameters}
{\em sign\-\_\-flag} & updated when there is a sign change \par
 sign\-\_\-flag = 0, during the negative half cycle \par
 sign\-\_\-flag = 1, during the positive half cycle \par
 \\
\hline
{\em freq\-\_\-val} & hold the timer value of one sine wave \\
\hline
{\em freq\-\_\-sum} & hold the accumulated timer counter for frequency calculation \\
\hline
{\em freq\-\_\-cnt} & hold the number of sine waves taken for frequency measument \\
\hline
\end{DoxyParams}


Definition at line 420 of file meter\-\_\-calculations.\-c.

\hypertarget{meter__calculations_8h_ad1c8219d5d9efbbcec5fa5328070d57b}{\index{meter\-\_\-calculations.\-h@{meter\-\_\-calculations.\-h}!lp\-\_\-filter@{lp\-\_\-filter}}
\index{lp\-\_\-filter@{lp\-\_\-filter}!meter_calculations.h@{meter\-\_\-calculations.\-h}}
\subsubsection[{lp\-\_\-filter}]{\setlength{\rightskip}{0pt plus 5cm}int16\-\_\-t lp\-\_\-filter (
\begin{DoxyParamCaption}
\item[{int16\-\_\-t $\ast$}]{inp\-\_\-array}
\end{DoxyParamCaption}
)}}\label{meter__calculations_8h_ad1c8219d5d9efbbcec5fa5328070d57b}
brief This function performs the low pass filtering of the input array


\begin{DoxyParams}{Parameters}
{\em lp\-\_\-coeff} & contains the coefficients for the low pass filtering \\
\hline
{\em lp\-\_\-output} & return the filtered value \\
\hline
\end{DoxyParams}


Definition at line 208 of file meter\-\_\-calculations.\-c.

\hypertarget{meter__calculations_8h_afd1b8bf2460cd858ce956e8ac527be04}{\index{meter\-\_\-calculations.\-h@{meter\-\_\-calculations.\-h}!meter\-\_\-flush@{meter\-\_\-flush}}
\index{meter\-\_\-flush@{meter\-\_\-flush}!meter_calculations.h@{meter\-\_\-calculations.\-h}}
\subsubsection[{meter\-\_\-flush}]{\setlength{\rightskip}{0pt plus 5cm}void meter\-\_\-flush (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{meter__calculations_8h_afd1b8bf2460cd858ce956e8ac527be04}
brief This function clear all the varilable used in for energy calculation 

Definition at line 447 of file meter\-\_\-calculations.\-c.

